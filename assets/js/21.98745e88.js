(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{405:function(t,s,n){"use strict";n.r(s);var a=n(42),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"安装-mitmproxy"}},[t._v("安装 mitmproxy")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("pip "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mitmproxy\n")])])]),n("p",[t._v("mitmproxy 包含 mitmproxy,mitmweb,mitmdump 三个主要模块")]),t._v(" "),n("ul",[n("li",[t._v("mitmproxy 直接在命令行中展示抓包结果")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("mitmproxy -p port\n")])])]),n("ul",[n("li",[t._v("mitmweb 打开一个可视化的 web GUI 来进行抓包")]),t._v(" "),n("li",[t._v("mitmdump 可以配合 python 脚本对抓包结果进行过滤")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("mitmdump -s crawler.py -p port\n")])])]),n("p",[t._v("crawler.py")]),t._v(" "),n("div",{staticClass:"language-py extra-class"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# crawler.py")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://edith.xiaohongshu.com/api/sns/v5/note/comment/list?note_id=6290229e0000000021038221&")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                         start=&num=15&show_priority_sub_comments=0&source=profile.userview&top_comment_id= HTTP/2.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n\nuidList "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/sns/v5/note/comment'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" content "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'comments'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                commentList "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'userid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" uidList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    uidList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'userid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uidList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" different users commented.'")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    commentList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nickname'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nickname'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                    commentList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'comment'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content_info.txt'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" encoding"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                        f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("commentList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ensure_ascii"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n")])])]),n("h2",{attrs:{id:"在抓包的移动设备上安装证书"}},[t._v("在抓包的移动设备上安装证书")]),t._v(" "),n("p",[t._v("无论通过 fiddler 还是 mitmproxy 对模拟器 Android 应用进行抓包都需要安装证书")]),t._v(" "),n("ul",[n("li",[n("p",[t._v('Android 证书分为“用户证书”和“系统证书”两种，在设置->安全->"查看安全证书"列表中，可以看到“系统”和“用户”两个列表。用户通过浏览器下载安装或者通过 WLAN 高级设置安装的证书均为用户证书。\n安装为系统证书有什么好处呢?')])]),t._v(" "),n("li",[n("p",[t._v("（1）安装用户证书必须要设置开机密码，而且设置后就不能取消，除非先删掉所有的用户证书。如果安装为系统证书就不需要设置开机密码，自动化操作时更方便。")])]),t._v(" "),n("li",[n("p",[t._v("（2）Android 7 以上版本 APP 默认不信任用户证书，只信任系统证书，安装为用户证书，对 APP 的 HTTPS 抓包会失败。安装为全局证书才能被所有 APP 信任，方可进行 HTTPS 抓包。")])]),t._v(" "),n("li",[n("p",[t._v("默认情况下，针对 Android 7.0+ (API level 24+) 的应用不再信任用户或管理员添加的 CA 证书来进行安全连接。（之前我们其实是将安全证书安装到安卓手机上作为用户信任安全证书，新版本如果 APP 开启了设置我们的代理请求会被认为是不安全的。）")])]),t._v(" "),n("li",[n("p",[t._v("Android 的系统证书的存储位置是/system/etc/security/cacerts，证书文件必须是 PEM 格式，而且文件命名必须符合系统证书规范。")])])]),t._v(" "),n("h3",{attrs:{id:"安装过程"}},[t._v("安装过程")]),t._v(" "),n("h3",{attrs:{id:"_1-准备工作"}},[t._v("1.准备工作")]),t._v(" "),n("p",[t._v("a.准备一台已经 root 的手机"),n("br"),t._v("\nb.准备 mitmproxy 证书文件"),n("br"),t._v("\nWindows 或者 Linux 在 mitmdump 第一次运行会在用户目录生成对应的文件。"),n("br"),t._v("\n目录位于：C:\\Users\\Administrator.mitmproxy")]),t._v(" "),n("p",[t._v("查看电脑是否成功连接到手机")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("adb devices -l "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 显示所有已连接的设备详细信息：127.0.0.1：62001")]),t._v("\n")])])]),n("p",[t._v("未连接则运行如下命令连接")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("adb connect "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:62001 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认端口")]),t._v("\n")])])]),n("h3",{attrs:{id:"_2-获取-mitmproxy-证书-hash-用来重命名"}},[t._v("2.获取 mitmproxy 证书 hash（用来重命名）")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.openssl.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("openssl"),n("OutboundLink")],1),t._v("是一个强大的安全套接字密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其他目的使用。"),n("br"),t._v("\nopenssl 整个软件可以分为三个主要的功能部分：密码算法库、SSL 协议库以及应用程序。"),n("br"),t._v("\n安装 openssl 有两种方式，第一种是下载源码，自己编译；第二种是装上安装包即可运行.")]),t._v(" "),n("p",[n("a",{attrs:{href:"http://slproweb.com/products/Win32OpenSSL.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("openssl installer for windows"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("在.mitmproxy 目录下运行 cmd")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PEM或者DER格式均可")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果是PEM格式：")]),t._v("\nIn: openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem -noout\nout: c8750f0d\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# x509命令具有输出证书信息，签署证书请求文件、生成自签名证书、转换证书格式等功能。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl x509工具不会使用openssl配置文件中的设定，而是完全需要自行设定或者使用该伪命令的默认值，它就像是一个完整的小型的CA工具箱。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -inform 控制输入和输出的文件类型，可选（PEM/NET/DER）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -in 指定输入文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -subject_hash_old 用md5的方式显示项目的hash值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -noout 没有证书输出")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果是DER格式：")]),t._v("\nIn: openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.cer -noout\nout: c8750f0d\n")])])]),n("p",[t._v("若报错：无法定位序数 4540 于动态链接库 LIBEAY32.dll 上")]),t._v(" "),n("p",[t._v("a.程序依赖于 libeay32.dll 动态链接库时：")]),t._v(" "),n("p",[t._v("创建脚本：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("@echo 开始注册\ncopy libeay32.dll %windir%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nregsvr32 %windir%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("libeay32.dll /s\n@echo libeay32.dll注册成功\n@pause\n")])])]),n("p",[t._v("b.程序不依赖于 libeay32.dll 动态链接库时：（无法定位序数一般情况下是不依赖）\n找到系统目录下的该库文件将其改个名，例如 win32 下：\n在系统盘的 windows 的 system32 下把 libeay32.dll 改成 libeay32_old.dll，就 OK 了。")]),t._v(" "),n("p",[t._v("c.如果程序依赖于该动态库，而且该库已经损坏，则需要重新下载")]),t._v(" "),n("h3",{attrs:{id:"_3-重命名-推送至手机"}},[t._v("3.重命名+推送至手机")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# window重命名 为符合android规范名称")]),t._v("\nren mitmproxy-ca-cert.pem c8750f0d.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或 linux重命名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" mitmproxy-ca-cert.pem c8750f0d.0\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 传入手机,此时必须确保adb devices下只有一台设备")]),t._v("\nadb push c8750f0d.0 /sdcard\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部分模拟器可能报错adb: error: failed to copy 'c8750f0d.0' to '/sdcard': couldn't create file: Is a directory，此时需要把路径输完整")]),t._v("\nadb push c8750f0d.0 /sdcard/c8750f0d.0\n")])])]),n("h3",{attrs:{id:"_4-通过-adb-shell-安装-mitm-证书到手机"}},[t._v("4.通过 adb shell 安装 mitm 证书到手机：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("adb shell\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换到root账户")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 挂载系统目录为可写")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o rw,remount /\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将证书移到Android系统证书目录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" /sdcard/c8750f0d.0 /system/etc/security/cacerts\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果仍然提示mv: /system/etc/security/cacerts/c8750f0d.0: Read-only file system")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o rw,remount -t auto /system\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o rw,remount -t auto /\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" /sdcard/c8750f0d.0 /system/etc/security/cacerts\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改证书权限")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("644")]),t._v(" /system/etc/security/cacerts/c8750f0d.0\n")])])]),n("p",[t._v("如果顺利，至此已经完成安装！")]),t._v(" "),n("p",[t._v("附完整过程")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("C:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Administrator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".mitmproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("openssl x509 -inform PEM -subject_hash_old -in\n mitmproxy-ca-cert.pem -noout\nWARNING: can"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'t open config file: G:"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("de"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[t._v("\\b")]),t._v("uild\\sb_0-33460670-1554108734.74\\openss\nl-1.0.2r-windows-vs14-64bit\\SSL/openssl.cnf\nc8750f0d\n\nC:\\Users\\Administrator\\.mitmproxy>openssl x509 -inform PEM -subject_hash_old -in\n mitmproxy-ca-cert.pem -noout\n\nC:\\Users\\Administrator\\.mitmproxy>cp mitmproxy-ca-cert.pem c8750f0d.0\n'")]),t._v("cp' 不是内部或外部命令，也不是可运行的程序或批处理文件。\n\nC:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Administrator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".mitmproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ren mitmproxy-ca-cert.pem c8750f0d.0\n\nC:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Administrator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".mitmproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("adb push c8750f0d.0 /sdcard\nc8750f0d.0: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" pushed, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" skipped. "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" MB/s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1318")]),t._v(" bytes "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(".071s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nC:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Administrator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".mitmproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("adb shell\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("999")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("999H"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("6n8HWVOG:/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# su")]),t._v("\nHWVOG:/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mount -o rw,remount /")]),t._v("\nHWVOG:/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv /sdcard/c8750f0d.0 /system/etc/security/cacerts")]),t._v("\nHWVOG:/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod 644 /system/etc/security/cacerts/c8750f0d.0")]),t._v("\nHWVOG:/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /system/build.prop | grep build.type")]),t._v("\nro.build.type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("user\n")])])]),n("h3",{attrs:{id:"_5-查看是否成功"}},[t._v("5.查看是否成功：")]),t._v(" "),n("p",[t._v("手机的设置——安全——凭据存储——信任的凭据（信任的 CA 证书）其下应该有 mitmproxy 项")]),t._v(" "),n("p",[t._v("若移动证书时报错：'/dev/block/dm-0' is read-only\n在次确认你是 root（#）状态下后，你可以执行以下命令来你查看的 android 的构建类型，在 adb shell 输入")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /system/build.prop "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" build.type\n")])])]),n("p",[t._v("如若 return 的信息显示你是开发版，继续往下")]),t._v(" "),n("p",[t._v("对于调试版本，用户必须首先 disable-verity：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("adb root\nadb disable-verity\nadb "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\nadb remount\nadb shell\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o rw,remount /system\n")])])]),n("p",[t._v("如果升级系统的话，可能需要重新拷入证书到系统目录。可以考虑将该证书做成 magisk 模块，这样升级系统后也无需重新拷入")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/u010132177/article/details/117199579",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);